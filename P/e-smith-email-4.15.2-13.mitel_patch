Index: e-smith-email/e-smith-email.spec
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/Authentication:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/Authentication	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+disabled
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/Instances
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/Instances:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/Instances	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+40
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/InstancesPerIP
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/InstancesPerIP:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/InstancesPerIP	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+5
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/PatternsScan
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/PatternsScan:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/PatternsScan	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+disabled
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/Proxy
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/Proxy:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/Proxy	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+enabled
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/TCPPort
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/TCPPort:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/TCPPort	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+25
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/VirusScan
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/VirusScan:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/VirusScan	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+enabled
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/access
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/access:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/access	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+public
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/status
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/status:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/status	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+enabled
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/type
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/type:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/smtpd/type	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+service
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/Authentication
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/Authentication:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/Authentication	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+enabled
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/Instances
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/Instances:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/Instances	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+10
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/TCPPort
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/TCPPort:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/TCPPort	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+465
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/access
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/access:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/access	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+public
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/status
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/status:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/status	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+enabled
Index: e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/type
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/type:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/defaults/ssmtpd/type	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+service
Index: e-smith-email/root/etc/e-smith/db/configuration/migrate/20smtpfront-qmail
diff -u /dev/null e-smith-email/root/etc/e-smith/db/configuration/migrate/20smtpfront-qmail:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/configuration/migrate/20smtpfront-qmail	Thu May  5 11:17:20 2005
@@ -0,0 +1,12 @@
+{
+    my $mailfront = $DB->get("smtpfront-qmail") or return;
+
+    my $smtpd = $DB->get("smtpd") || 
+	$DB->new_record("smtpd", { type => "service" });
+
+    $smtpd->merge_props($mailfront->props);
+
+    $smtpd->delete_prop($_) for ( qw(Patterns PatternsFile) );
+
+    $mailfront->delete;
+}
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/Body
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/Body:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/Body	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+TVqQAAMAA,TVpQAAIAA,TVpAALQAc,TVpyAXkAX,TVrmAU4AA,TVrhARwAk,TVoFAQUAA,TVoAAAQAA,TVoIARMAA,TVouARsAA,TVrQAT8AA,TVoAAAEAAA
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/Description
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/Description:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/Description	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+MS-DOS executables
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/Glob
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/Glob:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/Glob	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+yes
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/LineStart
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/LineStart:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/LineStart	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+yes
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/Status
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/Status:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/Status	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+enabled
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/type
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/type:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/EXEFILES/type	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+pattern
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/Body
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/Body:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/Body	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+R0lGODlhaAA7APcAAP///+rp6puSp6GZrDUjUUc6Zn53mFJMdbGvvVtXh2xre8bF1x8cU4yLprOy
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/Description
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/Description:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/Description	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+GIF file from old virus
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/Glob
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/Glob:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/Glob	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+yes
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/LineStart
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/LineStart:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/LineStart	Thu May  5 11:17:20 2005
@@ -0,0 +1 @@
+yes
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/Status
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/Status:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/Status	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+enabled
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/type
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/type:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/GIF01/type	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+pattern
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/Body
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/Body:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/Body	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+UEsDBAoAA
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/Description
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/Description:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/Description	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+Zip archive data, at least v1.0 to extract
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/Glob
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/Glob:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/Glob	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+yes
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/LineStart
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/LineStart:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/LineStart	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+yes
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/Status
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/Status:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/Status	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+enabled
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/type
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/type:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV1/type	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+pattern
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/Body
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/Body:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/Body	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+UEsDBBQAA
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/Description
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/Description:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/Description	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+Zip archive data, at least v2.0 to extract
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/Glob
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/Glob:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/Glob	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+yes
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/LineStart
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/LineStart:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/LineStart	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+yes
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/Status
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/Status:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/Status	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+disabled
Index: e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/type
diff -u /dev/null e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/type:1.1
--- /dev/null	Thu May  5 11:23:41 2005
+++ e-smith-email/root/etc/e-smith/db/mailpatterns/defaults/ZIPV2/type	Thu May  5 11:17:21 2005
@@ -0,0 +1 @@
+pattern
Index: e-smith-email/root/etc/e-smith/locale/en-us/etc/e-smith/web/functions/emailsettings
diff -u e-smith-email/root/etc/e-smith/locale/en-us/etc/e-smith/web/functions/emailsettings:1.22 e-smith-email/root/etc/e-smith/locale/en-us/etc/e-smith/web/functions/emailsettings:1.23
--- e-smith-email/root/etc/e-smith/locale/en-us/etc/e-smith/web/functions/emailsettings:1.22	Sun May  1 12:38:54 2005
+++ e-smith-email/root/etc/e-smith/locale/en-us/etc/e-smith/web/functions/emailsettings	Thu May  5 11:17:21 2005
@@ -185,11 +185,11 @@
     </entry>
     <entry>
         <base>ENABLED_BOTH</base>
-        <trans>Enabled (HTTP or HTTPS)</trans>
+        <trans>Allow both HTTP and HTTPS</trans>
     </entry>
     <entry>
         <base>ENABLED_SECURE_ONLY</base>
-        <trans>Enabled (secure HTTPS access only - recommended)</trans>
+        <trans>Allow HTTPS (secure)</trans>
     </entry>
     <entry>
         <base>PUBLIC</base>
@@ -205,7 +205,7 @@
     </entry>
     <entry>
         <base>SECURE_POP3</base>
-        <trans>Allow POP3S (secure) only</trans>
+        <trans>Allow POP3S (secure)</trans>
     </entry>
     <entry>
         <base>INSECURE_IMAP</base>
@@ -213,7 +213,7 @@
     </entry>
     <entry>
         <base>SECURE_IMAP</base>
-        <trans>Allow IMAPS (secure) only</trans>
+        <trans>Allow IMAPS (secure)</trans>
     </entry>
     <entry>
         <base>INSECURE_SMTP</base>
@@ -221,7 +221,7 @@
     </entry>
     <entry>
         <base>SECURE_SMTP</base>
-        <trans>Allow SSMTP (secure) only</trans>
+        <trans>Allow SSMTP (secure)</trans>
     </entry>
     <entry>
         <base>LABEL_POP_ACCESS_CONTROL</base>
@@ -233,7 +233,7 @@
     </entry>
     <entry>
         <base>LABEL_SMTP_AUTH_CONTROL</base>
-        <trans>SMTP Authentication</trans>
+        <trans>SMTP authentication</trans>
     </entry>
     <entry>
         <base>FORWARD_TO_ADMIN</base>
@@ -301,37 +301,34 @@
     </entry>
     <entry>
         <base>DESC_POP_ACCESS_CONTROL</base>
-        <trans><![CDATA[
+        <trans>
             You can control public POP3 server access. The POP3S
-            (recommended when enabled) setting can be used to provide
-            encrypted external access to your POP3 server.  POP3 access is
-            always available on the internal inteface.  We recommend leaving this
-            setting Disabled unless you have a specific reason to do otherwise.
-            ]]>
+            setting can be used to provide encrypted external access
+            to your POP3 server.  POP3 access is always available on
+            the internal inteface.  We recommend leaving this setting
+            Disabled unless you have a specific reason to do otherwise.
         </trans>
     </entry>
     <entry>
         <base>DESC_IMAP_ACCESS_CONTROL</base>
-        <trans><![CDATA[
+        <trans>
             You can control public IMAP server access. The IMAPS
-            (recommended when enabled) setting can be used to provide
-            encrypted external access to your IMAP server.  IMAP access is
-            always available on the internal inteface.  We recommend leaving this
-            setting Disabled unless you have a specific reason to do otherwise.
-            ]]>
+            setting can be used to provide encrypted external access
+            to your IMAP server.  IMAP access is always available on
+            the internal inteface.  We recommend leaving this setting
+            Disabled unless you have a specific reason to do otherwise.
         </trans>
     </entry>
     <entry>
         <base>DESC_SMTP_AUTH_CONTROL</base>
-        <trans><![CDATA[
-            Use the following field to provide external authenticated relay 
-            access to your SMTP server.  The SSMTP (recommended when enabled)
-            setting requires users to send their username and password encrypted
-            to your SMTP server.  Allowing external authenticated relay access
-            should only be used by experienced administrators.  Relay access is
-            always available on the internal inteface.  We recommend leaving this
-            setting Disabled unless you have a specific reason to do otherwise.
-            ]]>
+        <trans>
+            You can provide external authenticated relay access to your 
+	    SMTP server.  The SSMTP setting requires users to send their 
+	    username and password encrypted to your SMTP server.  Allowing
+	    external authenticated relay access should only be used by
+	    experienced administrators.  Relay access is always available
+	    on the internal inteface.  We recommend leaving this setting
+	    Disabled unless you have a specific reason to do otherwise.
         </trans>
     </entry>
     <entry>
@@ -339,13 +336,13 @@
         <trans>
             You can enable or disable webmail on this system. Webmail allows
             users to access their mail through a regular web browser by
-            pointing the browser to {$FQDN}/webmail,  and logging in to their
-            account.
+            pointing the browser to https://{$FQDN}/webmail,  and 
+ 	    logging in to their account.
         </trans>
     </entry>
     <entry>
         <base>LABEL_WEBMAIL</base>
-        <trans>Enable/Disable Webmail</trans>
+        <trans>Webmail access</trans>
     </entry>
     <entry>
         <base>SAVE</base>
Index: e-smith-email/root/etc/e-smith/templates/etc/rc.d/init.d/masq/90adjustSMTPProxy
diff -u e-smith-email/root/etc/e-smith/templates/etc/rc.d/init.d/masq/90adjustSMTPProxy:1.3 e-smith-email/root/etc/e-smith/templates/etc/rc.d/init.d/masq/90adjustSMTPProxy:1.4
--- e-smith-email/root/etc/e-smith/templates/etc/rc.d/init.d/masq/90adjustSMTPProxy:1.3	Fri Aug 22 16:50:43 2003
+++ e-smith-email/root/etc/e-smith/templates/etc/rc.d/init.d/masq/90adjustSMTPProxy	Thu May  5 11:17:21 2005
@@ -12,7 +12,7 @@
 	$rule++;
     }
 
-    if (${'smtpfront-qmail'}{'Proxy'} eq 'enabled')
+    if (${smtpd}{'Proxy'} eq 'enabled')
     {
 	$OUT .= "    /sbin/iptables --table nat --replace SMTPProxy $rule\\\n";
 	$OUT .= "\t-p TCP -j DNAT --to $LocalIP:25\n";
Index: e-smith-email/root/usr/lib/perl5/site_perl/esmith/FormMagick/Panel/emailsettings.pm
diff -u e-smith-email/root/usr/lib/perl5/site_perl/esmith/FormMagick/Panel/emailsettings.pm:1.11 e-smith-email/root/usr/lib/perl5/site_perl/esmith/FormMagick/Panel/emailsettings.pm:1.12
--- e-smith-email/root/usr/lib/perl5/site_perl/esmith/FormMagick/Panel/emailsettings.pm:1.11	Sun May  1 12:38:54 2005
+++ e-smith-email/root/usr/lib/perl5/site_perl/esmith/FormMagick/Panel/emailsettings.pm	Thu May  5 11:17:21 2005
@@ -1,7 +1,7 @@
 #!/usr/bin/perl -w 
 
 #
-# $Id: emailsettings.pm,v 1.10 2005/05/01 14:57:24 charlieb Exp $
+# $Id: emailsettings.pm,v 1.11 2005/05/01 16:38:54 charlieb Exp $
 #
 
 package    esmith::FormMagick::Panel::emailsettings;
@@ -25,14 +25,11 @@
   get_prop get_value validate_admin_email
 );
 
-our $VERSION = sprintf '%d.%03d', q$Revision: 1.10 $ =~ /: (\d+).(\d+)/;
+our $VERSION = sprintf '%d.%03d', q$Revision: 1.11 $ =~ /: (\d+).(\d+)/;
 
 our $db = esmith::ConfigDB->open;
 our $pattern_db = esmith::ConfigDB->open("/home/e-smith/mailpatterns");
 
-our $SMTPD = get_smtpd_program();
-our $SSMTPD = get_ssmtpd_program();
-
 # {{{ header
 
 =pod 
@@ -148,7 +145,7 @@
 
 sub get_secondary_mail_use_envelope {
 
-    my $use_envelope = $db->get('fetchmail')->prop('SecondaryMailEnvelope');
+    my $use_envelope = $db->get_prop('fetchmail', 'SecondaryMailEnvelope');
     if ( defined $use_envelope ) {
         return ('on');
     }
@@ -198,54 +195,50 @@
     my $FetchmailFreqWeekend = ( $q->param('FreqWeekend')   || 'everyhour' );
     my $SpecifyHeader        = ( $q->param('SpecifyHeader') || 'off' );
 
-
-    $db->get('fetchmail')->set_prop( "service", { status => "disabled" } )
-      unless ( $db->get("fetchmail") );
+    my $fetchmail = $db->get('fetchmail') || $db->new_record( "fetchmail", 
+			{ type => "service", status => "disabled" } );
 
     if ( $FetchmailMethod eq 'standard' ) {
-        $db->get('fetchmail')->set_prop( 'status', 'disabled' );
-        $db->get('fetchmail')->set_prop( 'Method', $FetchmailMethod );
+        $fetchmail->set_prop( 'status', 'disabled' );
+        $fetchmail->set_prop( 'Method', $FetchmailMethod );
     }
     else {
-        $db->get('fetchmail')->set_prop( 'status', 'enabled' );
-        $db->get('fetchmail')->set_prop( 'Method', $FetchmailMethod );
-        $db->get('fetchmail')
-          ->set_prop( 'SecondaryMailServer', $q->param('SecondaryMailServer') )
-          unless ( $q->param('SecondaryMailServer') eq '' );
-
-        $db->get('fetchmail')->set_prop( 'FreqOffice',  $FetchmailFreqOffice );
-        $db->get('fetchmail')->set_prop( 'FreqOutside', $FetchmailFreqOutside );
-        $db->get('fetchmail')->set_prop( 'FreqWeekend', $FetchmailFreqWeekend );
-        $db->get('fetchmail')
-          ->set_prop( 'SecondaryMailAccount',
-            $q->param('SecondaryMailAccount') )
-          unless ( $q->param('SecondaryMailAccount') eq '' );
-
-        $db->get('fetchmail')
-          ->set_prop( 'SecondaryMailPassword',
-            $q->param('SecondaryMailPassword') )
-          unless ( $q->param('SecondaryMailPassword') eq '' );
+        $fetchmail->set_prop( 'status', 'enabled' );
+        $fetchmail->set_prop( 'Method', $FetchmailMethod );
+        $fetchmail->set_prop( 'SecondaryMailServer', 
+	    $q->param('SecondaryMailServer') )
+	    unless ( $q->param('SecondaryMailServer') eq '' );
+
+        $fetchmail->set_prop('FreqOffice',  $FetchmailFreqOffice );
+        $fetchmail->set_prop('FreqOutside', $FetchmailFreqOutside );
+        $fetchmail->set_prop('FreqWeekend', $FetchmailFreqWeekend );
+        $fetchmail->set_prop('SecondaryMailAccount',
+	    q->param('SecondaryMailAccount') )
+	    unless ( $q->param('SecondaryMailAccount') eq '' );
+
+        $fetchmail->set_prop( 'SecondaryMailPassword',
+	    $q->param('SecondaryMailPassword') )
+	    unless ( $q->param('SecondaryMailPassword') eq '' );
 
         if ( $SpecifyHeader eq 'on' ) {
-            $db->get('fetchmail')
-              ->merge_props(
+            $fetchmail->merge_props(
                 'SecondaryMailEnvelope' => $q->param('SecondaryMailEnvelope') );
         }
         else {
-            $db->get("fetchmail")->delete_prop('SecondaryMailEnvelope');
+            $fetchmail->delete_prop('SecondaryMailEnvelope');
         }
     }
 
     my $smtpAuth = ($q->param('SMTPAuth') || 'disabled');
     if ($smtpAuth eq 'public') {
-        $db->get($SMTPD)->set_prop("authentication", "enabled" );
-        $db->get($SSMTPD)->set_prop("authentication", "enabled" );
+        $db->set_prop("smtpd", "Authentication", "enabled" );
+        $db->set_prop("ssmtpd", "Authentication", "enabled" );
     } elsif ($smtpAuth eq 'publicSSL') {
-        $db->get($SMTPD)->set_prop("authentication", "disabled" );
-        $db->get($SSMTPD)->set_prop("authentication", "enabled" );
+        $db->set_prop("smtpd", "Authentication", "disabled" );
+        $db->set_prop("ssmtpd", "Authentication", "enabled" );
     } else {
-        $db->get($SMTPD)->set_prop("authentication", "disabled" );
-        $db->get($SSMTPD)->set_prop("authentication", "disabled" );
+        $db->set_prop("smtpd", "Authentication", "disabled" );
+        $db->set_prop("ssmtpd", "Authentication", "disabled" );
     }
 
     unless ( system( "/sbin/e-smith/signal-event", "email-update" ) == 0 )
@@ -261,25 +254,12 @@
     my ($fm) = @_;
     my $q = $fm->{'cgi'};
 
-    my $DelegateMailServer =  $q->param('DelegateMailServer');
-
-    if ($DelegateMailServer)
-    {
-        my $d = $db->get('DelegateMailServer') ||
-		    $db->new_record('DelegateMailServer');
-        $d->set_value($DelegateMailServer);
-    }
-    else
-    {
-	my $d = $db->get('DelegateMailServer');
-	$d->delete() if $d;
-    }
-
     my $EmailUnknownUser = ($q->param('EmailUnknownUser') || 'returntosender');
 
-    $db->get('SMTPSmartHost')->set_value($q->param('SMTPSmartHost'));
-    $db->get('EmailUnknownUser')->set_value($EmailUnknownUser);
-    $db->get('AdminEmail')->set_value($q->param('AdminEmail'));
+    $db->set_value('SMTPSmartHost', $q->param('SMTPSmartHost'));
+    $db->set_value('DelegateMailServer', $q->param('DelegateMailServer'));
+    $db->set_value('EmailUnknownUser', $EmailUnknownUser);
+    $db->set_value('AdminEmail', $q->param('AdminEmail'));
 
     unless ( system( "/sbin/e-smith/signal-event", "email-update" ) == 0 )
     {
@@ -296,26 +276,26 @@
 
     my $pop3Access = ($q->param('POPAccess') || 'private');
     if ($pop3Access eq 'public') {
-        $db->get('popd')->set_prop("access", "public" );
-        $db->get('pop3s')->set_prop("access", "public" );
+        $db->set_prop('popd', "access", "public" );
+        $db->set_prop('pop3s', "access", "public" );
     } elsif ($pop3Access eq 'publicSSL') {
-        $db->get('popd')->set_prop("access", "private" );
-        $db->get('pop3s')->set_prop("access", "public" );
+        $db->set_prop('popd', "access", "private" );
+        $db->set_prop('pop3s', "access", "public" );
     } else {
-        $db->get('popd')->set_prop("access", "private" );
-        $db->get('pop3s')->set_prop("access", "private" );
+        $db->set_prop('popd', "access", "private" );
+        $db->set_prop('pop3s', "access", "private" );
     }
 
     my $imapAccess = ($q->param('IMAPAccess') || 'private');
     if ($imapAccess eq 'public') {
-        $db->get('imap')->set_prop("access", "public" );
-        $db->get('imaps')->set_prop("access", "public" );
+        $db->set_prop('imap', "access", "public" );
+        $db->set_prop('imaps', "access", "public" );
     } elsif ($imapAccess eq 'publicSSL') {
-        $db->get('imap')->set_prop("access", "private" );
-        $db->get('imaps')->set_prop("access", "public" );
+        $db->set_prop('imap', "access", "private" );
+        $db->set_prop('imaps', "access", "public" );
     } else {
-        $db->get('imap')->set_prop("access", "private" );
-        $db->get('imaps')->set_prop("access", "private" );
+        $db->set_prop('imap', "access", "private" );
+        $db->set_prop('imaps', "access", "private" );
     }
 
     #------------------------------------------------------------
@@ -327,24 +307,24 @@
 
     my $webmail = ($q->param('WebMail') || 'disabled');
     if ( $webmail eq "enabled" ) {
-      $db->get('php')->set_prop("status", $webmail );
-      $db->get('mysqld')->set_prop("status", $webmail );
-      $db->get('imp')->set_prop("status", $webmail );
-      $db->get('horde')->set_prop(  "status", $webmail );
-      $db->get('imp')->set_prop("access", "full" );
-      $db->get('horde')->set_prop("access", "full" );
+      $db->set_prop('php', "status", $webmail );
+      $db->set_prop('mysqld',"status", $webmail );
+      $db->set_prop('imp',"status", $webmail );
+      $db->set_prop('horde', "status", $webmail );
+      $db->set_prop('imp',"access", "full" );
+      $db->set_prop('horde',"access", "full" );
     }
     elsif ( $webmail eq "enabledSSL" ) {
-      $db->get('php')->set_prop("status", "enabled" );
-      $db->get('mysqld')->set_prop("status", "enabled" );
-      $db->get('imp')->set_prop("status", 'enabled' );
-      $db->get('horde')->set_prop("status", 'enabled' );
-      $db->get('imp')->set_prop("access", "SSL" );
-      $db->get('horde')->set_prop("access", "SSL" );
+      $db->set_prop('php',"status", "enabled" );
+      $db->set_prop('mysqld',"status", "enabled" );
+      $db->set_prop('imp',"status", 'enabled' );
+      $db->set_prop('horde',"status", 'enabled' );
+      $db->set_prop('imp',"access", "SSL" );
+      $db->set_prop('horde',"access", "SSL" );
     }
     else {
-      $db->get('imp')->set_prop("status", 'disabled' );
-      $db->get('horde')->set_prop( "status", 'disabled' );
+      $db->set_prop('imp',"status", 'disabled' );
+      $db->set_prop('horde',"status", 'disabled' );
     }
     
     unless ( system( "/sbin/e-smith/signal-event", "email-update" ) == 0 )
@@ -362,8 +342,7 @@
     my $q = $fm->{'cgi'};
 
     my $virus_status = ( $q->param('VirusStatus') || 'disabled' );
-    $db->set_prop($SMTPD, 'VirusScan', $virus_status);
-    $db->set_prop($SSMTPD, 'VirusScan', $virus_status);
+    $db->set_prop("smtpd", 'VirusScan', $virus_status);
 
     for my $param ( qw(
 			status 
@@ -377,8 +356,7 @@
     }
 
     my $patterns_status = $fm->adjust_patterns() ? 'enabled' : 'disabled';
-    $db->set_prop($SMTPD, 'Patterns', $patterns_status);
-    $db->set_prop($SSMTPD, 'Patterns', $patterns_status);
+    $db->set_prop("smtpd", 'PatternsScan', $patterns_status);
 
     unless ( system( "/sbin/e-smith/signal-event", "email-update" ) == 0 )
     {
@@ -451,13 +429,11 @@
 sub get_current_pop3_access {
     my ($fm, $localise) = @_;
 
-    my $pop3Record = $db->get('popd');
-    my $pop3Status = $pop3Record->prop('status') || 'enabled';
-    my $pop3Access = $pop3Record->prop('access') || 'private';
-
-    my $pop3sRecord = $db->get('pop3s');
-    my $pop3sStatus = $pop3sRecord->prop('status') || 'enabled';
-    my $pop3sAccess = $pop3sRecord->prop('access') || 'private';
+    my $pop3Status = $db->get_prop('popd', 'status') || 'enabled';
+    my $pop3Access = $db->get_prop('popd', 'access') || 'private';
+
+    my $pop3sStatus = $db->get_prop('pop3s', 'status') || 'enabled';
+    my $pop3sAccess = $db->get_prop('pop3s', 'access') || 'private';
 
     my $options = get_pop_options();
 
@@ -482,13 +458,11 @@
 sub get_current_imap_access {
     my ($fm, $localise) = @_;
 
-    my $imapRecord = $db->get('imap');
-    my $imapStatus = $imapRecord->prop('status') || 'enabled';
-    my $imapAccess = $imapRecord->prop('access') || 'private';
-
-    my $imapsRecord = $db->get('imaps');
-    my $imapsStatus = $imapsRecord->prop('status') || 'enabled';
-    my $imapsAccess = $imapsRecord->prop('access') || 'private';
+    my $imapStatus = $db->get_prop('imap', 'status') || 'enabled';
+    my $imapAccess = $db->get_prop('imap', 'access') || 'private';
+
+    my $imapsStatus = $db->get_prop('imaps', 'status') || 'enabled';
+    my $imapsAccess = $db->get_prop('imaps', 'access') || 'private';
 
     my $options = get_imap_options();
 
@@ -514,13 +488,11 @@
 
     my ($fm, $localise) = @_;
 
-    my $smtpd = $db->get($SMTPD);
-    my $smtpStatus = $smtpd->prop('status') || 'enabled';
-    my $smtpAuth = $smtpd->prop('authentication') || 'disabled';
-
-    my $ssmtpd = $db->get($SSMTPD);
-    my $smtpsStatus = $ssmtpd->prop('status') || 'enabled';
-    my $smtpsAuth = $ssmtpd->prop('authentication') || 'disabled';
+    my $smtpStatus = $db->get_prop('smtpd', 'status') || 'enabled';
+    my $smtpAuth = $db->get_prop('smtpd', 'Authentication') || 'disabled';
+
+    my $smtpsStatus = $db->get_prop('ssmtpd', 'status') || 'enabled';
+    my $smtpsAuth = $db->get_prop('ssmtpd', 'Authentication') || 'disabled';
 
     my $options = get_smtp_auth_options();
 
@@ -657,15 +629,9 @@
 {
     my ($self, $localise) = @_;
 
-    my $status = 'disabled';
-
-    for ( $SMTPD, $SSMTPD )
-    {
-        $status = 'enabled' if ($db->get_prop($_, 'Patterns') eq 'enabled');
-    }
+    my $status = $db->get_prop("smtpd", 'PatternsScan') || 'disabled';
 
     return $localise ? $self->localise_status($status) : $status;
-
 }
 
 sub adjust_patterns
@@ -723,41 +689,54 @@
 
 sub get_smtp_auth_options
 {
-    return { disabled => 'DISABLED', 
-            publicSSL  => 'SECURE_SMTP',
-            public  => 'INSECURE_SMTP'
-        };
+    my %options = ( disabled => 'DISABLED', publicSSL  => 'SECURE_SMTP' );
+
+    my $cleartext = $db->get_prop('smtpd', 'Authentication') || 'disabled';
+
+    $options{public} = 'INSECURE_SMTP' if ($cleartext eq 'enabled');
+
+    \%options;
 }
 
 sub get_pop_options
 {
-    return { private => 'DISABLED', 
-            publicSSL  => 'SECURE_POP3', 
-            public  => 'INSECURE_POP3'
-        };
+    my %options = ( private => 'DISABLED', publicSSL  => 'SECURE_POP3' );
+
+    my $access = $db->get_prop('popd', 'access') || 'private';
+
+    $options{public} = 'INSECURE_POP3' if ($access eq 'public');
+
+    \%options;
 }
 
 sub get_imap_options
 {
-    return { private => 'DISABLED', 
-            publicSSL  => 'SECURE_IMAP',
-            public  => 'INSECURE_IMAP'
-        };
+    my %options = ( private => 'DISABLED', publicSSL  => 'SECURE_IMAP' );
+
+    my $access = $db->get_prop('imap', 'access') || 'private';
+
+    $options{public} = 'INSECURE_IMAP' if ($access eq 'public');
+
+    \%options;
 }
 
 sub get_webmail_options
 {
-    return { disabled   => 'DISABLED',
-             enabledSSL => 'ENABLED_SECURE_ONLY',
-             enabled    => 'ENABLED_BOTH'
-         };
+    my %options = ( disabled   => 'DISABLED', 
+		enabledSSL => 'ENABLED_SECURE_ONLY' );
+
+    my $access = $db->get_prop('imp', 'access') || 'SSL';
+
+    $options{public} = 'ENABLED_BOTH' if ($access eq 'full');
+
+    \%options;
 }
 
 sub get_virus_status
 {
     my ($self, $localise) = @_;
 
-    my $status = $db->get_prop($SMTPD, 'VirusScan') || 'disabled';
+    my $status = $db->get_prop("smtpd", 'VirusScan') || 'disabled';
 
     return $localise ? $self->localise_status($status) : $status;
 }
@@ -787,18 +766,6 @@
 
     # return ($status eq 'enabled');
     return 1;	
-}
-
-sub get_smtpd_program
-{
-    return (($db->get_prop('qpsmtpd', 'status') || 'disabled') eq 'enabled') ?
-	'qpsmtpd' : 'smtpfront-qmail';
-}
-
-sub get_ssmtpd_program
-{
-    return (($db->get_prop('sqpsmtpd', 'status') || 'disabled') eq 'enabled') ?
-	'sqpsmtpd' : 'ssmtpfront-qmail';
 }
 
 sub localise_status
